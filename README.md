# taskhub

## 重要なメモ

- 現状各リクエスト内は直列に処理している  
  → テストケースが複数ある場合、１つ１つ処理する。なので、テストケースが多いと実行に時間がかかる。

- 現状、実行用コンテナはコールドスタートのみ  
  → 実行の都度起動するので、その分時間がかかる  
  ※ これとは関係なく、初めて利用するコンテナイメージの場合はコンテナイメージの取得時間もかかる。

- 課題ファイルはgithubで管理する  
  - アプリ起動時に読み込み、オンメモリで持つ
  - テストコードのみ、実行の度に読み取る

## 起動方法

### シングルノードの場合（１コンテナで起動）

以下のコマンドでコンテナイメージのビルドとコンテナの起動を行います。  
すでにコンテナ起動済みの場合、新しくビルドしたイメージで再構築を行います。  

```
bash run.sh
```

### シングルノードの場合（２コンテナで起動: dind）

検証用途を想定して起動します。

1. ホストマシン起動  

    dockerが使用できる環境で、シェルスクリプトが実行できれば良いです。  
    windowsの場合、wslなどを利用してください。  
    なお、ブラウザから利用する場合、デフォルトでは、外部から80番ポートへのアクセスが可能な環境が必要です。
    起動スクリプトの引数で、ホストマシン側のポートは指定可能です。  

2. dind環境作成  

    dind(docker in docker)を利用し、Dockerコンテナを起動できるDockerコンテナを起動します。  
    コンテナは２つ（manager, worker）起動します。  
    以下のコマンドで起動します。`port`は、指定しない場合`80`番になります。  

    ```
    $ bash tests/run_dind.sh [port]
    ```

3. アプリケーションコンテナの起動  

    起動したDockerコンテナ上に、アプリケーションコンテナを起動します。  

    ```
    $ docker exec eofe-manager bash run.sh
    ```
